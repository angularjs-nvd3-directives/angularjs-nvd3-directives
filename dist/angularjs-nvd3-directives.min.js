angular.module("nvd3ChartDirectives",[]),angular.module("legendDirectives",[]),angular.module("nvd3ChartDirectives").constant("nvd3Helpers",{defaults:function(){return{margin:{left:50,top:50,bottom:50,right:50},x:function(d){return d[0]},y:function(d){return d[1]},forceY:[0],showValues:!1,tooltips:!1,showXAxis:!1,showYAxis:!1,showLegend:!1,showControls:!1,interactive:!1,noData:"No Data Available.",staggerLabels:!1,delay:1200,color:nv.utils.defaultColor()}},chartDefaults:{bulletChart:{forceX:[],orient:"left",tickFormat:null},cumulativeLineChart:{forceX:[],rightAlignYAxis:!1,clipEdge:!1,clipVoronoi:!1,useVoronoi:!1,average:function(d){return d.average},isArea:function(d){return d.area}},discreteBarChart:{},lineChart:{forceX:[],size:function(d){return void 0===d.size?1:d.size},rightAlignYAxis:!1,clipEdge:!1,clipVoronoi:!1,interpolate:"linear",isArea:function(d){return d.area}},linePlusBar:{forceX:[],interpolate:"linear"},lineWithFocusChart:{forceX:[],height2:200,size:function(d){return void 0===d.size?1:d.size},isArea:function(d){return d.area},clipEdge:!1,clipVoronoi:!1,interpolate:"liear"},multiBarChart:{groupSpacing:.1},multiBarHorizontalChart:{stacked:!1},pieChart:{forceX:[],labelThreshold:.02,labelType:"key",pieLabelsOutside:!0,valueFormat:d3.format(",.2f"),description:function(d){return d.description},donutLabelsOutside:!1,donut:!1,donutRatio:.5},scatterChart:{forceX:[],size:function(d){return void 0===d.size?1:d.size},forceSize:[],tooltipContent:null,tooltipXContent:function(key,x){return"<strong>"+x+"</strong>"},tooltipYContent:function(key,x,y){return"<strong>"+y+"</strong>"},showDistX:!1,showDistY:!1,xPadding:0,yPadding:0,fisheye:0,transitionDuration:250},scatterPlusLineChart:{forceX:[],size:function(d){return void 0===d.size?1:d.size},tooltipContent:null,tooltipXContent:function(key,x){return"<strong>"+x+"</strong>"},tooltipYContent:function(key,x,y){return"<strong>"+y+"</strong>"},showDistX:!1,showDistY:!1,fisheye:0,transitionDuration:250},sparklinePlus:{forceX:[],xTickFormat:d3.format(",r"),yTickFormat:d3.format(",.2f"),showValue:!0,alignValue:!0,rightAlignValue:!1},stackedAreaChart:{forceX:[],size:function(d){return void 0===d.size?1:d.size},forceSize:[],clipEdge:!1}},getD3Selector:function(attrs,element){return attrs.id?"#"+attrs.id:(attrs["data-chartid"]||angular.element(element).attr("data-chartid","chartid"+Math.floor(1000000001*Math.random())),"[data-chartid="+attrs["data-chartid"]+"]")},rewriteOptions:function(chart,options){function internal(chart,options){angular.forEach(options,function(value,key){chart&&angular.isFunction(chart[key])&&!special[key]?angular.isUndefined(value)||(chart=chart[key](value)):chart&&special[key]?internal(invoke[key]?chart[key]():chart[key],value):"chartType"!==key&&console.log("Unknown configuration option: "+key)})}var special={yAxis:!0,y1Axis:!0,y2Axis:!0,xAxis:!0,x1Axis:!0,x2Axis:!0,legend:!0},invoke={scale:!0};internal(chart,this.merge(this.defaults(),this.chartDefaults[options.chartType],options))},merge:function(dst){var merge=this.merge;return angular.forEach(arguments,function(obj){obj&&obj!==dst&&angular.forEach(obj,function(value,key){dst[key]&&dst[key].constructor&&dst[key].constructor===Object?merge(dst[key],value):dst[key]=value})}),dst},processEvents:function(chart,scope){function maybeAddListener(object,args){object&&angular.forEach(args,function(name){object[name]&&object.dispatch.on(name+".directive",function(){var args=Array.prototype.slice.call(arguments);args.unshift(name+".directive"),scope.$emit.call(scope,args)})})}maybeAddListener(chart.dispatch&&chart,["tooltipShow","tooltipHide","beforeUpdate","stateChange","changeState"]),maybeAddListener(chart.lines,["elementMouseover.tooltip","elementMouseout.tooltip","elementClick"]),maybeAddListener(chart.stacked&&chart.stacked.dispatch&&chart.stacked,["areaClick.toggle","tooltipShow","tooltipHide"]),chart.interactiveLayer&&(maybeAddListener(chart.interactiveLayer.elementMouseout&&chart.interactiveLayer,["elementMouseout"]),maybeAddListener(chart.interactiveLayer.elementMousemove&&chart.interactiveLayer,["elementMousemove"])),angular.forEach(["discretebar","multibar","pie","scatter","bullet"],function(element){maybeAddListener(chart[element],["elementMouseover.tooltip","elementMouseout.tooltip","elementClick"])}),maybeAddListener(chart.legend,["stateChange.legend","legendClick","legendDblclick","legendMouseover"]),maybeAddListener(chart.controls&&chart.controls.legendClick&&chart.controls,["legendClick"])},checkElementID:function(scope,attrs,element,chart,data){this.processEvents(chart,scope);var svgElem=element.find("svg")[0];angular.isArray(data)&&0===data.length&&d3.select(svgElem).remove(),d3.select(svgElem).empty()&&d3.select(element).append("svg"),d3.select(svgElem).attr("viewBox","0 0 "+scope.opts.width+" "+scope.opts.height).datum(data).transition().duration(void 0===attrs.transitionduration?250:+attrs.transitionduration).call(chart)},updateDimensions:function(scope,attrs,element,chart){if(chart){chart.width(scope.opts.width).height(scope.opts.height);var d3Select=getD3Selector(attrs,element);d3.select(d3Select+" svg").attr("viewBox","0 0 "+scope.opts.width+" "+scope.opts.height),nv.utils.windowResize(chart),scope.chart.update()}}}),angular.module("nvd3ChartDirectives").directive("nvd3Chart",["$filter","nvd3Helpers",function($filter,nvd3Helpers){return{restrict:"EA",scope:{opts:"=nvd3Chart",data:"=ngModel"},controller:["$scope","$element","$attrs",function($scope,$element,$attrs){$scope.d3Call=function(data,chart){nvd3Helpers.checkElementID($scope,$attrs,$element,chart,data),nvd3Helpers.rewriteOptions(chart,$scope.opts)}}],link:function(scope,element,attrs){scope.$watch("opts.width + opts.height",function(){nvd3Helpers.updateDimensions(scope,attrs,element,scope.chart)}),scope.$watch("data",function(data){if(data&&angular.isDefined(scope.opts.filtername)&&angular.isDefined(scope.opts.filtervalue)&&(data=$filter(scope.opts.filtername)(data,scope.opts.filtervalue)),data){if(scope.chart)return scope.d3Call(data,scope.chart);nv.addGraph({generate:function(){console.log("creating chart: "+scope.opts.chartType);var chart=nv.models[scope.opts.chartType]();return nvd3Helpers.rewriteOptions(chart,scope.opts),scope.d3Call(data,chart),nv.utils.windowResize(chart.update),scope.chart=chart,chart},callback:void 0===scope.opts.callback?null:scope.opts.callback()})}},!!scope.opts.objectequality)}}}]),angular.module("legendDirectives").directive("nvd3Legend",[function(){var margin,width,height,id;return{restrict:"EA",scope:{data:"=",id:"@",margin:"&",width:"@",height:"@",key:"&",color:"&",align:"@",rightalign:"@",updatestate:"@",radiobuttonmode:"@",x:"&",y:"&"},link:function(scope,element,attrs){scope.$watch("data",function(data){if(data){if(scope.chart)return d3.select("#"+attrs.id+" svg").attr("height",height).attr("width",width).datum(data).transition().duration(250).call(scope.chart);margin=scope.$eval(attrs.margin)||{top:5,right:0,bottom:5,left:0},width=void 0===attrs.width?element[0].parentElement.offsetWidth-(margin.left+margin.right):+attrs.width-(margin.left+margin.right),height=void 0===attrs.height?element[0].parentElement.offsetHeight-(margin.top+margin.bottom):+attrs.height-(margin.top+margin.bottom),(void 0===width||0>width)&&(width=400),(void 0===height||0>height)&&(height=20),id=attrs.id?attrs.id:"legend-"+Math.random(),nv.addGraph({generate:function(){var chart=nv.models.legend().width(width).height(height).margin(margin).align(void 0===attrs.align?!0:"true"===attrs.align).rightAlign(void 0===attrs.rightalign?!0:"true"===attrs.rightalign).updateState(void 0===attrs.updatestate?!0:"true"===attrs.updatestate).radioButtonMode(void 0===attrs.radiobuttonmode?!1:"true"===attrs.radiobuttonmode).color(void 0===attrs.color?nv.utils.defaultColor():scope.color()).key(void 0===attrs.key?function(d){return d.key}:scope.key());return d3.select("#"+attrs.id+" svg")[0][0]||d3.select("#"+attrs.id).append("svg"),d3.select("#"+attrs.id+" svg").attr("height",height).attr("width",width).datum(data).transition().duration(250).call(chart),nv.utils.windowResize(chart.update),scope.chart=chart,chart}})}})}}}]),angular.module("legendDirectives").directive("simpleSvgLegend",function(){return{restrict:"EA",scope:{id:"@",width:"@",height:"@",margin:"@",x:"@",y:"@",labels:"@",styles:"@",classes:"@",shapes:"@",padding:"@",columns:"@"},compile:function(){return function(scope,element,attrs){var id,width,height,margin,paddingStr,svg,g,labels,styles,classes,shapes,widthTracker=0,heightTracker=0,columns=1,columnTracker=0,padding=10,svgNamespace="http://www.w3.org/2000/svg",x=0,y=0;margin=scope.$eval(attrs.margin)||{left:5,top:5,bottom:5,right:5},width="undefined"===attrs.width?element[0].parentElement.offsetWidth-(margin.left+margin.right):+attrs.width-(margin.left+margin.right),height="undefined"===attrs.height?element[0].parentElement.offsetHeight-(margin.top+margin.bottom):+attrs.height-(margin.top+margin.bottom),id=attrs.id?attrs.id:"legend-"+Math.random(),attrs.columns&&(columns=+attrs.columns),attrs.padding&&(padding=+attrs.padding),paddingStr=padding+"",svg=document.createElementNS(svgNamespace,"svg"),attrs.width&&svg.setAttribute("width",width+""),attrs.height&&svg.setAttribute("height",height+""),svg.setAttribute("id",id),attrs.x&&(x=+attrs.x),attrs.y&&(y=+attrs.y),element.append(svg),g=document.createElementNS(svgNamespace,"g"),g.setAttribute("transform","translate("+x+","+y+")"),svg.appendChild(g),attrs.labels&&(labels=scope.$eval(attrs.labels)),attrs.styles&&(styles=scope.$eval(attrs.styles)),attrs.classes&&(classes=scope.$eval(attrs.classes)),attrs.shapes&&(shapes=scope.$eval(attrs.shapes));for(var i in labels)if(labels.hasOwnProperty(i)){var shape,text,textSize,g1,shpe=shapes[i];columnTracker%columns===0&&(widthTracker=0,heightTracker+=padding+1.5*padding),g1=document.createElementNS(svgNamespace,"g"),g1.setAttribute("transform","translate("+widthTracker+", "+heightTracker+")"),"rect"===shpe?(shape=document.createElementNS(svgNamespace,"rect"),shape.setAttribute("y",0-padding/2+""),shape.setAttribute("width",paddingStr),shape.setAttribute("height",paddingStr)):"ellipse"===shpe?(shape=document.createElementNS(svgNamespace,"ellipse"),shape.setAttribute("rx",paddingStr),shape.setAttribute("ry",padding+padding/2+"")):(shape=document.createElementNS(svgNamespace,"circle"),shape.setAttribute("r",padding/2+"")),styles&&styles[i]&&shape.setAttribute("style",styles[i]),classes&&classes[i]&&shape.setAttribute("class",classes[i]),g1.appendChild(shape),widthTracker=widthTracker+shape.clientWidth+(padding+padding/2),text=document.createElementNS(svgNamespace,"text"),text.setAttribute("transform","translate(10, 5)"),text.appendChild(document.createTextNode(labels[i])),g1.appendChild(text),g.appendChild(g1),textSize=text.clientWidth,widthTracker=widthTracker+textSize+(padding+.75*padding),columnTracker++}}}}});